/*** Generated by streamline 0.1.36-stack - DO NOT EDIT ***/ var __global = typeof global !== 'undefined' ? global : window;var __srcName='streamline/lib/util/flows_.js'; function __func(_, __this, __arguments, fn, index, frame, body) { if (!_) { return __future.call(__this, fn, __arguments, index); } frame.file = __srcName; frame.prev = __global.__frame; __global.__frame = frame; try { body(); } catch (e) { e.__frame = e.__frame || frame.prev; __propagate(_, e); } finally { __global.__frame = __frame.prev; } } function __cb(_, frame, offset, col, fn){ frame.offset = offset; frame.col = col; var ctx = __global.__context; return function ___(err, result){ var oldFrame = __global.__frame; __global.__frame = frame; __global.__context = ctx; try { if (err) { err.__frame = err.__frame || frame; return _(err); } return fn(null, result); } catch (ex) { ex.__frame = ex.__frame || frame; return __propagate(_, ex); } finally { __global.__frame = oldFrame; } } } function __future(fn, args, i){ var done, err, result; var cb = function(e, r){ done = true; err = e, result = r; }; args = Array.prototype.slice.call(args); args[i] = function ___(e, r){ cb(e, r); }; fn.apply(this, args); return function ___(_){ if (done) _.call(this, err, result); else cb = _.bind(this); } .bind(this); } function __nt(_, frame, fn){ var i = 0; var cb = __cb(_, frame, 0, 0, fn); if (typeof process != "undefined" && typeof process.nextTick == "function") return function ___(){ if (++i % 20 == 0) process.nextTick(cb); else cb(); }; else return function ___(){ if (++i % 20 == 0) setTimeout(cb, 0); else cb(); }; } function __propagate(_, err){ try { _(err); } catch (ex) { __trap(ex); } } function __trap(err){ if (err) { if (__global.__context && __global.__context.errorHandler) __global.__context.errorHandler(err); else console.error("UNCAUGHT EXCEPTION: " + err.message + "\n" + err.stack); } } function __forIn(object){ var array = []; for (var obj in object) { array.push(obj); } return array; } (function(exports) {


































 "use strict";







 exports.each = function exports_each__1(_, array, fn, thisObj) { var len, i; var __frame = { name: "exports_each__1", line: 44 }; return __func(_, this, arguments, exports_each__1, 0, __frame, function __$exports_each__1() {
 if ((!array || !array.length)) { return _(null); } ;

 len = array.length;
 i = 0; var __2 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_each__1() { if (__2) { i++; } else { __2 = true; } ; var __1 = (i < len); if (__1) {
 return fn.call(thisObj, __cb(_, __frame, 5, 3, __loop), array[i], i); } else { __break(); } ; }); __loop(); })(function __$exports_each__1() {
 return _(null, array); }); }); };




 exports.map = function exports_map__2(_, array, fn, thisObj) { var result, len, i; var __frame = { name: "exports_map__2", line: 55 }; return __func(_, this, arguments, exports_map__2, 0, __frame, function __$exports_map__2() {
 if (!array) {
 return _(null, array); } ;
 result = [];
 len = array.length;
 i = 0; var __3 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_map__2() { if (__3) { i++; } else { __3 = true; } ; var __2 = (i < len); if (__2) {
 return fn.call(thisObj, __cb(_, __frame, 6, 15, function ___(__0, __1) { result[i] = __1; __loop(); }), array[i], i); } else { __break(); } ; }); __loop(); })(function __$exports_map__2() {
 return _(null, result); }); }); };




 exports.filter = function exports_filter__3(_, array, fn, thisObj) { var result, len, i, elt; var __frame = { name: "exports_filter__3", line: 67 }; return __func(_, this, arguments, exports_filter__3, 0, __frame, function __$exports_filter__3() {
 if (!array) {
 return _(null, array); } ;
 result = [];
 len = array.length;
 i = 0; var __3 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_filter__3() { if (__3) { i++; } else { __3 = true; } ; var __2 = (i < len); if (__2) {
 elt = array[i];
 return fn.call(thisObj, __cb(_, __frame, 7, 7, function ___(__0, __1) { return (function __$exports_filter__3(__then) { if (__1) {
 result.push(elt); __then(); } else { __then(); } ; })(__loop); }), elt); } else { __break(); } ; }); __loop(); })(function __$exports_filter__3() {

 return _(null, result); }); }); };




 exports.every = function exports_every__4(_, array, fn, thisObj) { var len, i; var __frame = { name: "exports_every__4", line: 82 }; return __func(_, this, arguments, exports_every__4, 0, __frame, function __$exports_every__4() {
 if (!array) { return _(null); } ;

 len = array.length;
 i = 0; var __4 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_every__4() { if (__4) { i++; } else { __4 = true; } ; var __3 = (i < len); if (__3) {
 return fn.call(thisObj, __cb(_, __frame, 5, 8, function ___(__0, __2) { var __1 = !__2; return (function __$exports_every__4(__then) { if (__1) {
 return _(null, false); } else { __then(); } ; })(__loop); }), array[i]); } else { __break(); } ; }); __loop(); })(function __$exports_every__4() {

 return _(null, true); }); }); };




 exports.some = function exports_some__5(_, array, fn, thisObj) { var len, i; var __frame = { name: "exports_some__5", line: 95 }; return __func(_, this, arguments, exports_some__5, 0, __frame, function __$exports_some__5() {
 if (!array) { return _(null); } ;

 len = array.length;
 i = 0; var __3 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_some__5() { if (__3) { i++; } else { __3 = true; } ; var __2 = (i < len); if (__2) {
 return fn.call(thisObj, __cb(_, __frame, 5, 7, function ___(__0, __1) { return (function __$exports_some__5(__then) { if (__1) {
 return _(null, true); } else { __then(); } ; })(__loop); }), array[i]); } else { __break(); } ; }); __loop(); })(function __$exports_some__5() {

 return _(null, false); }); }); };




 exports.reduce = function exports_reduce__6(_, array, fn, v, thisObj) { var len, i; var __frame = { name: "exports_reduce__6", line: 108 }; return __func(_, this, arguments, exports_reduce__6, 0, __frame, function __$exports_reduce__6() {
 if (!array) {
 return _(null, v); } ;
 len = array.length;
 i = 0; var __3 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_reduce__6() { if (__3) { i++; } else { __3 = true; } ; var __2 = (i < len); if (__2) {
 return fn.call(thisObj, __cb(_, __frame, 5, 7, function ___(__0, __1) { v = __1; __loop(); }), v, array[i], i, array); } else { __break(); } ; }); __loop(); })(function __$exports_reduce__6() {

 return _(null, v); }); }); };




 exports.reduceRight = function exports_reduceRight__7(_, array, fn, v, thisObj) { var len, i; var __frame = { name: "exports_reduceRight__7", line: 120 }; return __func(_, this, arguments, exports_reduceRight__7, 0, __frame, function __$exports_reduceRight__7() {
 if (!array) {
 return _(null, v); } ;
 len = array.length;
 i = (len - 1); var __3 = false; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_reduceRight__7() { if (__3) { i--; } else { __3 = true; } ; var __2 = (i >= 0); if (__2) {
 return fn.call(thisObj, __cb(_, __frame, 5, 7, function ___(__0, __1) { v = __1; __loop(); }), v, array[i], i, array); } else { __break(); } ; }); __loop(); })(function __$exports_reduceRight__7() {

 return _(null, v); }); }); };








 exports.eachKey = function exports_eachKey__8(_, obj, fn, thisObj) { var key; var __frame = { name: "exports_eachKey__8", line: 136 }; return __func(_, this, arguments, exports_eachKey__8, 0, __frame, function __$exports_eachKey__8() {
 if (!obj) {
 return _(null, obj); } ;
 var __1 = __forIn(obj); var __2 = 0; return (function ___(__break) { var __loop = __nt(_, __frame, function __$exports_eachKey__8() { var __3 = (__2 < __1.length); if (__3) { key = __1[__2++]; return (function __$exports_eachKey__8(__then) {
 if (Object.prototype.hasOwnProperty.call(obj, key)) {
 return fn.call(thisObj, __cb(_, __frame, 5, 4, __then), key, obj[key]); } else { __then(); } ; })(__loop); } else { __break(); } ; }); __loop(); })(function __$exports_eachKey__8() {

 return _(null, obj); }); }); };





 exports.spray = function(fns, max) {
 return new function() {

 var funnel = exports.funnel(max);
 this.collect = function(callback, count, trim) {
 if ((typeof (callback) != "function")) {
 throw new Error("invalid call to collect: no callback") };
 var results = (trim ? [] : new Array(fns.length));
 count = ((count < 0) ? fns.length : Math.min(count, fns.length));
 if ((count == 0)) {
 return callback(null, results) };
 var collected = 0;
 for (var i = 0; (i < fns.length); i++) {
 (function(i) {
 funnel(function(err, result) {
 if (err) {
 return callback(err) };
 if (trim) {
 results.push(result); } else {

 results[i] = result; };
 if ((++collected == count)) {
 return callback(null, results) };
 }, fns[i]);
 })(i); }; };


 this.collectOne = function(callback) {
 return this.collect(function(err, result) {
 return callback(err, (result && result[0]));
 }, 1, true); };

 this.collectAll = function(callback) {
 return this.collect(callback, -1, false); }; }; };


















 exports.funnel = function(max) {
 max = ((typeof max == "undefined") ? -1 : max);
 var queue = [];
 var active = 0;

 return function(callback, fn) {

 if ((max < 0)) {
 return fn(callback) };

 queue.push({
 fn: fn,
 cb: callback });


 function _doOne() {
 var current = queue.splice(0, 1)[0];
 if (!current.cb) {
 return current.fn() };
 active++;
 current.fn(function(err, result) {
 active--;
 current.cb(err, result);
 while (((active < max) && (queue.length > 0))) { _doOne();; }; }); };




 while (((active < max) && (queue.length > 0))) { _doOne();; }; }; };







 exports.collect = function exports_collect__9(_, futures) { var __frame = { name: "exports_collect__9", line: 237 }; return __func(_, this, arguments, exports_collect__9, 0, __frame, function __$exports_collect__9() {
 return exports.map(__cb(_, __frame, 1, 9, _), futures, function __1(_, future) { var __frame = { name: "__1", line: 238 }; return __func(_, this, arguments, __1, 0, __frame, function __$__1() {
 return future(__cb(_, __frame, 1, 10, _)); }); }); }); };


















 exports.setContext = function(ctx) {
 var old = __global.__context;
 __global.__context = ctx;
 return old; };



 exports.getContext = function() {
 return __global.__context; };








 exports.nextTick = (((typeof process === "object") && (typeof process.nextTick === "function")) ? process.nextTick : function(callback) {

 setTimeout(function() { callback(); }, 0); });







 exports.apply = function apply(callback, fn, thisObj, args, index) {
 if ((callback == null)) {
 return __future(apply, arguments, 0) };
 args.splice(((index != null) ? index : args.length), 0, callback);
 return fn.apply(thisObj, args); };







 exports.stackTrace = function(err) {
 var s = "", f, skip, skipFunc = 0;
 if (err.stack) {
 var ff;
 s = err.stack.split("\n").map(function(l) {


 var m = /(^[^(]+)\([^)]*\)\@(.*)\:(\d+)$/.exec(l);
 l = (m ? (((((("    at " + m[1]) + " (") + m[2]) + ":") + ((parseInt(m[3]) - 12))) + ":0)") : l);
 ff = (ff || ((m != null)));
 var i = l.indexOf("__$");
 if (((i >= 0) && !skip)) {
 skip = true;
 return ((l.substring(0, i) + l.substring((i + 3))) + "\n"); } ;

 return (skip ? "" : (l + "\n"));
 }).join("");
 if (ff) {
 s = ((("Error: " + err.message) + "\n") + s); };
 for (var f = err.__frame; f; f = f.prev) {
 s += (((((((("    at " + f.name) + " (") + f.file) + ":") + ((f.line + f.offset))) + ":") + f.col) + ")\n"); }; } ;


 return s; };


})(((typeof exports !== "undefined") ? exports : (window.StreamlineFlows = (window.StreamlineFlows || {}))));